---
title: "운영체제와 커널, 그리고 동기/비동기식 I/O"
description: "운영체제 기본 개념에 대해 알아보자"
date: 2023-11-30
update: 2023-11-30
tags: ["operating-system"]
series: "운영체제 기본 개념"
---

## 운영체제는 무엇이고 어떤 역할을 수행하는가?

운영체제는 컴퓨팅 시스템을 운영하는 시스템이다.

약간 말장난 같지만, 실제로 운영체제는 사용자와 하드웨어 사이에서 자원을 어떻게 사용할 지를 결정한다.

대표적인 역할로는 프로세스 스케줄링, 프로세스 동기화 방식 등이 있다.

## 시분할 시스템

하나의 프로세서가 2개 이상의 프로세스의 작업을 처리해야할 때, 각각의 프로세스의 작업을 얼마만큼의 시간동안 처리를 할 것인지에 대한 정책이다.

시분할 시스템을 구현하기 위한 다양한 알고리즘이 있지만, 현재 가장 널리 사용되는 알고리즘은 Round-Robin 알고리즘이다.

Round Robin 알고리즘은, 각 프로세스의 CPU 할당 시간을 동일하게 설정하고, 할당 시간이 끝이 나면 인터럽트를 발생시켜 다음 프로세스의 작업을 수행하도록 하는 과정의 알고리즘이다.

보통 할당 시간은 매우 짧은 시간에 속하지만, CPU는 이 시간안에 매우 빠른 속도로 작업을 처리하기 때문에 사용자는 2개 이상의 프로세스가 동시에 실행되는 것처럼 보인다.

## 다중 프로그래밍 시스템(multi-programming system)

2개 이상의 프로그램이, 하나의 메모리에 동시에 적재되는 시스템을 말한다.

이때, 프로그램이 메모리에 적재될 때, 프로그램 전체를 올리진 않는다. 

용량이 작은 메모리에 2개 이상의 프로그램 전체를 적재할 수 없기 때문이다. 

따라서 당장 필요한 부분만 메모리에 적재한다.

## 대화형 시스템(interactive system)

사용자가 컴퓨터와 1:1로 대화한다는 느낌의 시스템이다.

다른 말로, 사용자가 입력한 결과가 컴퓨터에 즉시 출력된다는 것이다.

실제로는 여러 사용자가 한 대의 컴퓨터를 이용함에도, 1:1처럼 인식한다는 것이다.

이는 다중 프로그래밍 시스템과 시분할 시스템의 적용으로 가능하다.

## 다중 처리기 시스템(multi-processor system)

프로세서가 2개 이상인 시스템이다.

당연하게도 모든 프로세서가 자원을 함께 사용한다.

대칭적 다중 처리 시스템: 단일 운영체제 아래에서 2개 이상의 CPU가 동작하는 시스템이다.

각 CPU끼리는 데이터를 효율적으로 공유하는 구조로 운영된다.

비대칭적 다중 처리 시스템: 1개의 메인 CPU가 시스템을 제어하며, 나머지 CPU들은 미리 정의된 작업을 수행한다.

## 시스템 콜

프로세스가 OS 커널이 제공하는 서비스를 이용하고 싶을 때, 시스템 콜을 이용해 실행한다.

### 종류
- 프로세스/스레드 관련
- 파일 IO 관련
- 소켓 관련
- Device 관련 (키보드 등)
- 프로세스 통신 관련

시스템 콜이 발생하면, 커널은 CPU에게 Interrupt를 발생하고, CPU는 다음 명령을 실행할 때 체크하고, 해당 커널 코드를 실행

## 커널

OS의 core라고 할 수 있다.

항상 메모리에 적재되어있다.

HW와 프로세스 사이의 인터페이스로서, 프로세스가 요청하는 시스템 콜에 대해 직접 수행한다.

왜 인터페이스?

프로세스는 개발된 프로그래밍 언어가 모두 다르고, 시스템 콜을 호출하는 방식이 모두 다르기 때문에 중간에 추상 계층이 필요하기 때문

운영체제와 커널의 차이?

커널은 운영 체제에 포함되는 하나의 모듈의 개념이다.

운영체제는 커널을 포함해, 컴퓨터 시스템을 총괄하는 개념으로 이해하고 있다.

## 유저모드와 커널모드

- 유저모드: 프로세서가 응용 프로그램을 실행하는 모드
- 커널모드: 프로세서가 커널 코드를 실행하는 모드

유저 모드에서 커널 모드로 전환될 때 인터럽트나 시스템 콜이 발생한다.

CPU의 mode bit 레지스터로 구분한다.

0이면 커널 모드, 1이면 유저 모드

커널모드가 필요한 이유는 누군가 만든 프로그램이 하드웨어를 직접 통제하게 되고, 점유하는 등과 같은 문제로 다른 프로세스에 영향을 미칠 수 있기 때문이다.

즉, 시스템을 보호하기 위해서

## 폴링

CPU가 I/O Device의 작업 내용이나 결과를 직접 확인하는 방식이다.

이 방식은 CPU의 작업이 수행되어야 하기에 프로세스 관점에서는 불필요한 오버헤드이다.

이 비효율적인 방식을 개선하기 위해 인터럽트가 탄생했다.

## 인터럽트

시스템에서 발생한 다양한 종류의 이벤트

### 종류
- 전원에 문제가 생겼을 때
- IO 작업이 완료됐을 때
- 시간이 다 됐을 때 (timer 관련)
- 프로그램에서 0으로 나눴을 때
- 프로그램에서 잘못된 메모리 공간에 접근을 시도할 때

- 인터럽트 벡터: 인터럽트의 처리 루틴 주소를 가짐
- 인터럽트 처리 루틴: 인터럽트를 처리하는 커널 함수

## DMA

CPU는 매우 빠른 속도로 메모리에만 접근한다. 동시에 SSD 같은 비교적 빠른 I/O Device가 존재한다.

이런 상황에서 Device들이 잦은 빈도로 인터럽트를 발생하면, CPU의 성능이 떨어진다.

이를 방지하고자, I/O Device에서 각 buffer storage의 내용을 메모리에 block 단위로 직접 전송하고, 인터럽트를 발생하는 개념이다.

이 DMA는 CPU와 I/O Device 사이에 위치하는 DMA Controller에 의해 수행된다.

## 동기식 I/O과 비동기식 I/O

프로세스에 의해 I/O 요청이 발생하면, 프로세서는 이 요청을 처리한다.
이때, 동기식 I/O의 경우는 해당 I/O 작업이 완료된 후에야 다음 작업을 처리한다.
비동기식 I/O의 경우는 I/O 작업을 요청보내고, 바로 다음 작업을 실행한다.

동기식 I/O의 경우, 프로세스의 다음 작업이 디스크에서 읽은 값을 이용한 처리라면 적용할 수 있다.
하지만, I/O 작업의 경우 시간이 오래 걸리는 작업이기에 CPU의 효율을 매우 떨어트리는 방식이다.
즉, CPU의 성능을 희생하는 대신 작업의 결과를 보장할 수 있다.

비동기식 I/O의 경우, 프로세스의 다음 작업이 I/O 작업과 관련이 없는 경우 적용할 수 있다.
하지만 비동기식 I/O 작업의 결과를 즉시에 알 수 없다. 확인하려면 또 다른 요청이 필요할 수 있다.
그래도 CPU가 쉬지 않고 일할 수 있으므로 CPU의 효율을 끌어올릴 수 있다.

위의 경우는 하나의 프로세스에서의 경우를 가정한 것이다.
하지만 보통은 다수의 프로세스를 동시에 처리한다.
이때, I/O 작업을 요청한 프로세스는, 해당 작업이 완료될 때까지 대기시켜놓고, 그 시간동안 CPU는 다른 프로세스의 작업을 처리한다. 즉, 동기식 I/O 처리를 하며 CPU 스케줄링을 통해 CPU 성능과 작업의 정합성을 모두 지킨다.