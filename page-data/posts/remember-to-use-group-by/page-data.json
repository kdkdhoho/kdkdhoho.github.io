{"componentChunkName":"component---src-templates-blog-post-js","path":"/posts/remember-to-use-group-by/","result":{"data":{"site":{"siteMetadata":{"title":"김동호 블로그"}},"markdownRemark":{"id":"7c86c29a-8f65-52e8-86ab-e3af34e8a377","excerpt":"문제 상황 식당의 정보를 가지는  테이블과 각 식당의 리뷰 데이터를 가지는  테이블이 있습니다. 이 두 테이블을 조인해서 원하는 칼럼의 값과 특정 식당의 평균 점수를 가져오는 요구 사항이 있었습니다. 처음엔 아래와 같이 SQL…","html":"<h1 id=\"문제-상황\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C-%EC%83%81%ED%99%A9\" aria-label=\"문제 상황 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.65 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제 상황</h1>\n<p>식당의 정보를 가지는 <code class=\"language-text\">REST_INFO</code> 테이블과 각 식당의 리뷰 데이터를 가지는 <code class=\"language-text\">REST_REVIEW</code> 테이블이 있습니다.</p>\n<p>이 두 테이블을 조인해서 원하는 칼럼의 값과 특정 식당의 평균 점수를 가져오는 요구 사항이 있었습니다.</p>\n<p>처음엔 아래와 같이 SQL을 작성했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> ri<span class=\"token punctuation\">.</span>rest_id<span class=\"token punctuation\">,</span> ri<span class=\"token punctuation\">.</span>rest_name<span class=\"token punctuation\">,</span> ri<span class=\"token punctuation\">.</span>food_type<span class=\"token punctuation\">,</span> ri<span class=\"token punctuation\">.</span>favorites<span class=\"token punctuation\">,</span> ri<span class=\"token punctuation\">.</span>address<span class=\"token punctuation\">,</span> <span class=\"token function\">ROUND</span><span class=\"token punctuation\">(</span><span class=\"token function\">AVG</span><span class=\"token punctuation\">(</span>rr<span class=\"token punctuation\">.</span>review_score<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> average\n<span class=\"token keyword\">FROM</span> rest_info ri <span class=\"token keyword\">JOIN</span> rest_review rr <span class=\"token keyword\">ON</span> ri<span class=\"token punctuation\">.</span>rest_id <span class=\"token operator\">=</span> rr<span class=\"token punctuation\">.</span>rest_id\n<span class=\"token keyword\">WHERE</span> ri<span class=\"token punctuation\">.</span>address <span class=\"token operator\">LIKE</span> <span class=\"token string\">'서울%'</span>\n<span class=\"token keyword\">GROUP</span> <span class=\"token keyword\">BY</span> ri<span class=\"token punctuation\">.</span>rest_id\n<span class=\"token keyword\">ORDER</span> <span class=\"token keyword\">BY</span> average <span class=\"token keyword\">DESC</span><span class=\"token punctuation\">,</span> ri<span class=\"token punctuation\">.</span>favorites <span class=\"token keyword\">DESC</span></code></pre></div>\n<p>원하는 결과는 나왔지만, <code class=\"language-text\">GROUP BY</code> 절에서 잘못 사용했다는 점을 알게 됐습니다.</p>\n<h1 id=\"왜-잘못-사용했는가\" style=\"position:relative;\"><a href=\"#%EC%99%9C-%EC%9E%98%EB%AA%BB-%EC%82%AC%EC%9A%A9%ED%96%88%EB%8A%94%EA%B0%80\" aria-label=\"왜 잘못 사용했는가 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.65 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>왜 잘못 사용했는가?</h1>\n<p>ANSI 표준 SQL의 원칙은 다음과 같습니다.<br>\n\"<em>SELECT 절에 있는 컬럼 중, 집계 함수(SUM, AVG, COUNT 등)에 들어가지 않은 모든 컬럼은 반드시 GROUP BY 절에 명시해야 한다.</em>\"</p>\n<p>하지만 저는 어차피 id로 묶으면 결과는 똑같이 묶인다고 판단해서 id로만 그룹화를 수행했습니다.</p>\n<p>그렇다면 결과는 똑같은데 왜 굳이 SELECT 절에 있는 칼럼 중, 집계 함수를 제외한 모든 칼럼을 GROUP BY 절에 명시해야 할까요?</p>\n<p>바로, <strong>DB 엔진이 그룹으로 묶이지 않은 데이터 중 어떤 것을 출력해야 할지 스스로 결정하지 않기 위해서</strong>입니다.<br>\n과거 MySQL의 경우 \"어차피 ID가 같으면 이름이나 주소도 같겠지?\"라고 대충 이해하고 결과를 보여줍니다. 이를 'Hidden Columns' 허용이라고 합니다.</p>\n<p>하지만 현대 MySQL, Oracle, SQL Server에서는 \"<em>id는 묶였는데 이름은 그룹화되지 않았어! 어떤 이름을 가져올지 모르겠으니 에러를 낼게!</em>\" 라며 실행을 거부합니다.</p>\n<p>우리는 id가 유니크하다는 걸 알지만, DB 입장에서는 id가 같아도 address가 여러 개일 가능성을 배제할 수도, 보장할 수도 없기 때문입니다.</p>\n<p>따라서 조회하려는 모든 정보가 이 그룹 내에서 유일하다는 것을 문법적으로 확정해주는 작업이, 바로 GROUP BY에 모든 컬럼을 적는 것입니다.</p>\n<h1 id=\"참고\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0\" aria-label=\"참고 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.65 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고</h1>\n<ul>\n<li><a href=\"https://dev.mysql.com/doc/refman/8.0/en/group-by-handling.html\">MySQL 공식문서 - 14.19.3 MySQL Handling of GROUP BY</a></li>\n</ul>","tableOfContents":"<ul>\n<li><a href=\"#%EB%AC%B8%EC%A0%9C-%EC%83%81%ED%99%A9\">문제 상황</a></li>\n<li><a href=\"#%EC%99%9C-%EC%9E%98%EB%AA%BB-%EC%82%AC%EC%9A%A9%ED%96%88%EB%8A%94%EA%B0%80\">왜 잘못 사용했는가?</a></li>\n<li><a href=\"#%EC%B0%B8%EA%B3%A0\">참고</a></li>\n</ul>","frontmatter":{"title":"[SQL] GROUP BY 사용할 때 명심할 점","date":"2026년 2월 26일","dateISO":"2026-02-26","description":"GROUP BY 사용하면서 실수한 경험에 대해 기록했습니다.","tags":["SQL","GROUP BY"]}},"previous":{"fields":{"slug":"/posts/what-is-computer-network/"},"frontmatter":{"title":"컴퓨터 네트워크 개요"}},"next":{"fields":{"slug":"/posts/sql-union-and-union-all/"},"frontmatter":{"title":"[SQL] UNION과 UNION ALL 정리"}}},"pageContext":{"id":"7c86c29a-8f65-52e8-86ab-e3af34e8a377","previousPostId":"aab0fc7d-5f75-5294-8bbf-8a4c0f975cac","nextPostId":"79822319-2e0e-56f2-b737-4f8582103960"}},"staticQueryHashes":["2637872971","3361002528","3414707483"],"slicesMap":{}}