{"componentChunkName":"component---src-templates-post-jsx","path":"/05-isolation-level-of-MySQL/","result":{"data":{"site":{"siteMetadata":{"title":"log4dh"}},"markdownRemark":{"id":"c1af5fc8-26e9-523f-ab94-cd74c7a9f8b5","excerpt":"들어가며 MySQL에는 4가지의 격리 수준이 존재한다. 격리 수준에 따라 같은 상황, 그리고 같은 쿼리라 하더라도 결과가 매번 달라질 수 있다.\n이로 인해 정합성 문제가 발생할 수 있다. 우리가 실행하는 쿼리문이 적어도 격리 수준에 따라 어떤 결과를 가져올 지 정확하게 예측할 수 있어야 하기에, MySQL의 격리 수준에 대해 이해해보자. 트랜잭션 격리 수…","html":"<h2>들어가며</h2>\n<p>MySQL에는 4가지의 격리 수준이 존재한다.</p>\n<p>격리 수준에 따라 같은 상황, 그리고 같은 쿼리라 하더라도 결과가 매번 달라질 수 있다.<br>\n이로 인해 정합성 문제가 발생할 수 있다.</p>\n<p>우리가 실행하는 쿼리문이 적어도 격리 수준에 따라 어떤 결과를 가져올 지 정확하게 예측할 수 있어야 하기에, MySQL의 격리 수준에 대해 이해해보자.</p>\n<h2>트랜잭션 격리 수준</h2>\n<p>트랜잭션 격리 수준이란, <strong>여러 트랜잭션이 동시에 처리될 때 특정 트랜잭션이 변경하는 값을 다른 트랜잭션이 조회할 때 어떤 값을 반환할 지 결정하는 것</strong>이다.</p>\n<p>MySQL의 트랜잭션 격리 수준은 총 4가지다.</p>\n<ul>\n<li>Read Uncommitted</li>\n<li>Read Committed</li>\n<li>Repeatable Reade</li>\n<li>Serializable</li>\n</ul>\n<p>각 격리 수준에 따라 동일한 상황에서 조회 결과가 달라진다.<br>\n그리고 트랜잭션을 동시에 처리할 수 있는 성능의 차이도 발생한다.</p>\n<p>일반적인 온라인 서비스 용도의 데이터베이스는 <em>Read Committed</em>와 <em>Repeatable Read</em> 중 하나를 사용한다.<br>\nMySQL은 주로 <em>Repeatable Read</em>를 사용한다.</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\"></th>\n<th align=\"center\">Dirty Read</th>\n<th align=\"center\">Non-Repeatable Read</th>\n<th align=\"center\">Phantom Read</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\">Read Uncommitted</td>\n<td align=\"center\">O</td>\n<td align=\"center\">O</td>\n<td align=\"center\">O</td>\n</tr>\n<tr>\n<td align=\"center\">Read Committed</td>\n<td align=\"center\">X</td>\n<td align=\"center\">O</td>\n<td align=\"center\">O</td>\n</tr>\n<tr>\n<td align=\"center\">RepeatableRead</td>\n<td align=\"center\">X</td>\n<td align=\"center\">X</td>\n<td align=\"center\">O (InnoDB는 X)</td>\n</tr>\n<tr>\n<td align=\"center\">Serializable</td>\n<td align=\"center\">X</td>\n<td align=\"center\">X</td>\n<td align=\"center\">X</td>\n</tr>\n</tbody>\n</table>\n<h2>Read Uncommitted</h2>\n<p>먼저 그림으로 이해해보자.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/9fd5908d198e6d39d3c7485f19dfbce9/ed887/read_uncommitted_1.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 67.64705882352942%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABnElEQVR42p2TS0/CQBSFL1aolLZYoKKIQRgEgxqMj5gYXGlCohiJysYdW/4DG34EC3b8U89tTs0scEOTL53O45z7mIqIGBCBJjgGLsiCHNkFHgjBCcc71rqNnksE8xSrgkNQpECRAhXQBncgpsk+94Qcq9ijMLo68MEeOOCcTzGPwj1wCY6seXvdAS/CgQqkT9OK0DC6OvdENNWydBh1i/v1eROGX7IEDdPWMlyAPrhijTS1gpr4vsSuK818Xmr4Dmg03hRhh2lVy2WpeZ7cYPxAk4iCEWup5l02KwMmmwTbbJBGdg1U8J1GJUZei2MZGCPDel1+wjBplmbwnQrGPKBu9+qo6UwmcjufyzPePTar0mgkqcXTqQxWK/lYr+V1NkuCyDuOfKY17LEZmsKTiiICs1jIaLmU4XicmBWs61FizXzO55jyX4R2U85Ag51zOefyepR5uEzhrPUT6PrXf9fmHJwibRMEiUFajhYvv6Fxm3TZtNEmQY/XwLfeaWoBI/c34LHbyX9p6FRj8fv8zsgWT9qUgPVwyDZimV+62yKFDBGxlwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='read uncommitted 1' title='' src='/static/9fd5908d198e6d39d3c7485f19dfbce9/ca1dc/read_uncommitted_1.png' srcset='/static/9fd5908d198e6d39d3c7485f19dfbce9/e7570/read_uncommitted_1.png 170w,\n/static/9fd5908d198e6d39d3c7485f19dfbce9/f46e7/read_uncommitted_1.png 340w,\n/static/9fd5908d198e6d39d3c7485f19dfbce9/ca1dc/read_uncommitted_1.png 680w,\n/static/9fd5908d198e6d39d3c7485f19dfbce9/02d09/read_uncommitted_1.png 1020w,\n/static/9fd5908d198e6d39d3c7485f19dfbce9/9d567/read_uncommitted_1.png 1360w,\n/static/9fd5908d198e6d39d3c7485f19dfbce9/ed887/read_uncommitted_1.png 1484w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>트랜잭션 1번이 특정 레코드에 UPDATE 작업을 수행한다.<br>\n동시에 언두 로그에는 변경되기 전의 값이 저장된다.</p>\n<p>트랜잭션 1번이 커밋이나 롤백하기 전, 트랜잭션 2번에 의해 <code class=\"language-text\">id=2</code>인 레코드를 조회하는 상황에 Read Uncommitted는 아래같이 수행된다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/a188df08bdd682b7cd0d28cac781709d/de412/read_uncommitted_2.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 53.529411764705884%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABiElEQVR42pWSPUvDUBSGjx9p+plGW03TL2sTqVaLgjooVN3sUusgCEpXN5eC+CMKXQQnf47uzm4O4s/Q9yRvSoY6eOAhN/eeez7ee0REKmAFrAETzINFMAdyPF/lXhZkiK4TYAms83sjvGADB5SABfK8pIl2gAcMBjCYOE0//VbBMjgRZtJNNZeZtKIiE3h0Vr8asenj8J7BvcDSzChsO8+qO6DMVnUvn0xK3TSl6ThB9WV2oLZAeaYBk1x7zNwAh+CM1dlEE+6CTQZ0ZwVMUbcsHd1EQtpbHem6Reluo8X9sMJCrydXo5HcDgZyzGC1WQHVuQX2KKo/HMrR07OcP15L4x6Cv6SCaux+X5zJRNzxePpgdQ1wGspiRQEzsUfRCuuWFbQZvWL2Ae1Vw9YNjpXJUan8pWH0KCWOQBPie0Av+RfoAC20cNhW0KcHJx9j4H4i2avIwSUkiVfoUMMcxY4SBPaB/2/4/UBv5QtFvONfwZn1hoe8C8csMG1lIzbMBQ7wf8zg/Movo7UmvFuoHFsAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='read uncommitted 2' title='' src='/static/a188df08bdd682b7cd0d28cac781709d/ca1dc/read_uncommitted_2.png' srcset='/static/a188df08bdd682b7cd0d28cac781709d/e7570/read_uncommitted_2.png 170w,\n/static/a188df08bdd682b7cd0d28cac781709d/f46e7/read_uncommitted_2.png 340w,\n/static/a188df08bdd682b7cd0d28cac781709d/ca1dc/read_uncommitted_2.png 680w,\n/static/a188df08bdd682b7cd0d28cac781709d/02d09/read_uncommitted_2.png 1020w,\n/static/a188df08bdd682b7cd0d28cac781709d/9d567/read_uncommitted_2.png 1360w,\n/static/a188df08bdd682b7cd0d28cac781709d/de412/read_uncommitted_2.png 1868w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>트랜잭션 2번은 버퍼 풀에 있는 값을 조회한다.</p>\n<p>만약 이후에 트랜잭션 1번이 롤백된다면, 트랜잭션 2번의 조회 결과는 데이터베이스에 존재하지 않은 결과가 된다.<br>\n즉, 정합성에 크리티컬한 문제가 발생한다.</p>\n<p>특정 트랜잭션에서 처리한 작업이 완료되지 않았는데도 다른 트랜잭션에서 볼 수 있는 현상을 <em>Dirty Read</em>라고 한다.<br>\n<strong><em>Read Uncommitted</em> 에서는 이 <em>Dirty Read</em> 문제가 발생한다.</strong></p>\n<h2>Read Committed</h2>\n<p>이번에도 역시 그림으로 이해해보자.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/9fd5908d198e6d39d3c7485f19dfbce9/ed887/read_uncommitted_1.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 67.64705882352942%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABnElEQVR42p2TS0/CQBSFL1aolLZYoKKIQRgEgxqMj5gYXGlCohiJysYdW/4DG34EC3b8U89tTs0scEOTL53O45z7mIqIGBCBJjgGLsiCHNkFHgjBCcc71rqNnksE8xSrgkNQpECRAhXQBncgpsk+94Qcq9ijMLo68MEeOOCcTzGPwj1wCY6seXvdAS/CgQqkT9OK0DC6OvdENNWydBh1i/v1eROGX7IEDdPWMlyAPrhijTS1gpr4vsSuK818Xmr4Dmg03hRhh2lVy2WpeZ7cYPxAk4iCEWup5l02KwMmmwTbbJBGdg1U8J1GJUZei2MZGCPDel1+wjBplmbwnQrGPKBu9+qo6UwmcjufyzPePTar0mgkqcXTqQxWK/lYr+V1NkuCyDuOfKY17LEZmsKTiiICs1jIaLmU4XicmBWs61FizXzO55jyX4R2U85Ag51zOefyepR5uEzhrPUT6PrXf9fmHJwibRMEiUFajhYvv6Fxm3TZtNEmQY/XwLfeaWoBI/c34LHbyX9p6FRj8fv8zsgWT9qUgPVwyDZimV+62yKFDBGxlwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='read uncommitted 1' title='' src='/static/9fd5908d198e6d39d3c7485f19dfbce9/ca1dc/read_uncommitted_1.png' srcset='/static/9fd5908d198e6d39d3c7485f19dfbce9/e7570/read_uncommitted_1.png 170w,\n/static/9fd5908d198e6d39d3c7485f19dfbce9/f46e7/read_uncommitted_1.png 340w,\n/static/9fd5908d198e6d39d3c7485f19dfbce9/ca1dc/read_uncommitted_1.png 680w,\n/static/9fd5908d198e6d39d3c7485f19dfbce9/02d09/read_uncommitted_1.png 1020w,\n/static/9fd5908d198e6d39d3c7485f19dfbce9/9d567/read_uncommitted_1.png 1360w,\n/static/9fd5908d198e6d39d3c7485f19dfbce9/ed887/read_uncommitted_1.png 1484w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>위와 동일한 상황이다.<br>\n마찬가지로 트랜잭션 1번이 Commit 되기 전, 트랜잭션 2번이 조회하는 상황에 Read Committed 격리 수준은 아래같이 수행된다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/1e9fa35c97570b3e58c718614ef540c4/de412/read_committed.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 53.529411764705884%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABe0lEQVR42pWSTU7CUBSFLyClrUD5SWkLWEENEiMaITpRE0cyEBN1ookhMdGEHTgw7oA9MGIjTlyJO3ABei49kkZw4E2+tO+9++7PuU9EpAZcsA4yIAlWQALkeF7hXpas8muAImiCArgTXtCFB3yQBw4vaaJdsMmA6Rgm/WywBsrgTJhJN9WqzOjSwWewIpOG7KTEswrvpXk+M5utqtVjle5xnWU1rmVJrVSSuufNqm/STy1FeRYC1uioVRyBU+6ZrEoTdECLbXrLAlrUTTca2qJhSLvVkpNeT84zGdlQ/cJQgtFIHl5e5en5UW6uRfZvEfgrGl6KMeYBVacuOHQc6Y7HcjGZyOV0Kse2LYFWmMtJeTCQcDiU8L4vAabRuIoCpvki8vGWLf6HqG4b1TU5mAK/BieajeH2EfQTg3mDTJ1ocAsa+py0VlU3zZlO1dhEf9AkwRZ8PqDlO3T9HVB1avNZJGW5Jf5AeGc+FG3lQPWLTe1fthNJou9WvgHSFyKbLnmB9AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='read committed' title='' src='/static/1e9fa35c97570b3e58c718614ef540c4/ca1dc/read_committed.png' srcset='/static/1e9fa35c97570b3e58c718614ef540c4/e7570/read_committed.png 170w,\n/static/1e9fa35c97570b3e58c718614ef540c4/f46e7/read_committed.png 340w,\n/static/1e9fa35c97570b3e58c718614ef540c4/ca1dc/read_committed.png 680w,\n/static/1e9fa35c97570b3e58c718614ef540c4/02d09/read_committed.png 1020w,\n/static/1e9fa35c97570b3e58c718614ef540c4/9d567/read_committed.png 1360w,\n/static/1e9fa35c97570b3e58c718614ef540c4/de412/read_committed.png 1868w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p><em>Read Uncommitted</em> 와 달리 버퍼 풀이 아닌, <strong>언두 로그에 있는 값을 조회한다.</strong><br>\n즉, <strong>커밋이나 롤백되지 않은 변경은 조회하지 않게 된다.</strong></p>\n<p>따라서 Dirty Read 문제는 발생하지 않는다.<br>\n하지만 다른 문제가 존재한다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/d3c5d8de5167feb9e86415fe738c4d55/2edc3/non_repeatable_read.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 49.411764705882355%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABU0lEQVR42mNggAAuILYAYkUozQgVB9HMUIwsBgKqQGwJxOZALMuABlighoEkpIFYGIgFgFgIiPWB2ATKBokJguSBHGkDoKE5DAyerQwMGheA+k8xMCiBDGOF2soD1cAONZAF6jKQOAeUzwoV441hYBA7CsR7mBl8H8kwBN6wZrC5qgl2NYMjEKsAsQTUFZxQGh/gAtrIC7KgXoZB5dNcBpu3Cxm8/v+H6IuEGmoGxJJQgyXQwgvDQJDL5SEu50dXywH1qi7UQEZoOMEUoWMQ4IYGBbs8RC/DqlAGZqAL4YbyQ2NNCBpGBL0MMxDuwv8oFsIV8UHZYlBDBbFgkIvE7YF0B9CwpQwM9tcYGHQOMzDIAWNaB9lAbqhiBqQYxYWZnwIdMAFo8DZhBt/H3gyVT4oZwu67MWggG8gBdRkxAOY1YV1pBpn/zxnEHk9nUP13i4EdAPxLLeKjeDA1AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='non repeatable read' title='' src='/static/d3c5d8de5167feb9e86415fe738c4d55/ca1dc/non_repeatable_read.png' srcset='/static/d3c5d8de5167feb9e86415fe738c4d55/e7570/non_repeatable_read.png 170w,\n/static/d3c5d8de5167feb9e86415fe738c4d55/f46e7/non_repeatable_read.png 340w,\n/static/d3c5d8de5167feb9e86415fe738c4d55/ca1dc/non_repeatable_read.png 680w,\n/static/d3c5d8de5167feb9e86415fe738c4d55/02d09/non_repeatable_read.png 1020w,\n/static/d3c5d8de5167feb9e86415fe738c4d55/9d567/non_repeatable_read.png 1360w,\n/static/d3c5d8de5167feb9e86415fe738c4d55/2edc3/non_repeatable_read.png 2031w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>트랜잭션 2번의 입장에서 <strong>하나의 트랜잭션 안에서 동일한 쿼리의 결과가 달라진다.</strong><br></p>\n<p>이러한 문제를 <em>Non-Repeatable Read</em> 문제라고 하며, 분명하게 정합성에 오류가 존재하는 문제다.</p>\n<h2>Repeatable Read</h2>\n<p><strong>MySQL에서 기본으로 사용되는 격리 수준이다.</strong></p>\n<p><em>Read Committed</em> 와 마찬가지로 언두 로그에 존재하는 값을 조회한다.<br>\n하지만 차이가 있다면, 언두 로그에 백업된 레코드의 여러 버전 중 몇 번째 이전 버전까지 조회할 것인가에 차이가 있다.</p>\n<p>더 자세히 알아보자.</p>\n<p>모든 InnoDB의 트랜잭션은 고유 번호를 가지며, 언두 로그의 모든 레코드에는 변경을 발생시킨 트랜잭션의 번호가 포함된다.<br>\n그리고 언두 로그의 데이터는 InnoDB가 불필요하다고 판단되는 시점에 주기적으로 삭제한다.</p>\n<p><em>Repeatable Read</em> 격리 수준일 때는 정합성을 보장하기 위해 <strong>실행 중인 트랜잭션 중, 가장 오래된 트랜잭션 번호보다 더 앞선 언두 로그의 데이터는 삭제할 수 없다.</strong></p>\n<p>더 정확하게는 <strong>특정 트랜잭션 번호의 구간 내에서 백업된 언두 데이터를 모두 보존한다.</strong></p>\n<p>그림을 통해 Repeatable Read 수준에서는 어떻게 동작하는지 이해해보자.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/61404d6fa8922d151b02514424f6ac61/a4646/repeatable_read_1.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 54.70588235294118%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABAElEQVR42pWTXU/CQBBFFz8S8QER2GILKFUxhhcFScAYTPRViK/C//8h3tFTMhCIOMnJdpqdO7N32xBCeBNXYiKS8Bslh48it32voi+Gouw33Ysb0RWZOBcV8kcKTkUNqqJF3Yv4EB0Gyk3wWFyIA5HyfEbxECKNGrzvsY7FlxiJZwb5OUaDaTt0r1LQpEmKLbbWEbRok1/TcOVLdN7MxEJ8iilHiwjWye/c/k2f1wStYCnmePIunjYupOsmTLZdoBeMTGZTDvDI/DkUJ6y3WwR3Tphhrk31AMXtt/Gwt49gcSk1DLbiS8h554l/CSZ8Nv+NuEswc4KlPbA44odYi29tQBGUmlO6OAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='repeatable read 1' title='' src='/static/61404d6fa8922d151b02514424f6ac61/ca1dc/repeatable_read_1.png' srcset='/static/61404d6fa8922d151b02514424f6ac61/e7570/repeatable_read_1.png 170w,\n/static/61404d6fa8922d151b02514424f6ac61/f46e7/repeatable_read_1.png 340w,\n/static/61404d6fa8922d151b02514424f6ac61/ca1dc/repeatable_read_1.png 680w,\n/static/61404d6fa8922d151b02514424f6ac61/02d09/repeatable_read_1.png 1020w,\n/static/61404d6fa8922d151b02514424f6ac61/9d567/repeatable_read_1.png 1360w,\n/static/61404d6fa8922d151b02514424f6ac61/a4646/repeatable_read_1.png 1829w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>전제 조건은 다음과 같다.</p>\n<p>트랜잭션 1번이 2개의 레코드를 삽입한 상황이고, 트랜잭션 3번이 <code class=\"language-text\">id=2</code>인 레코드를 조회한다.</p>\n<p>그 다음 트랜잭션 2번이 <code class=\"language-text\">id=2</code>인 레코드에 UPDATE를 수행한다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/04301891349f8e62ebb5cc9ad151566d/0c665/repeatable_read_2.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 48.8235294117647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABQUlEQVR42o2SzUsCURTFj8UM6fQ0TZO+jSmbSDOJMEUiIQiG0MiVZYtcFLhs1bJli/7ozrMzZWLShR9z5717z7vvzABfsUjOSEBO8RMxMi9i+B0HpEoqZH2sfhQO8UmBbJI0SZGMGk70bteXlBc0wA2pKbe1MMTVlEmJ2+IsiZOiGtYkZNdXyY4Ob5IL3XDZCt6Ra3KoAttYInt62sa89irK7W1yxNMgngYbRUMFgYoceXNPQtLhTeu7JfNYr+G1XMZbKoWuBOzEiUn/oiQRneI4OG400B8M0L5t4xLZ8Pzh5aj58Y6r4RAd30dLXhrZMlXQk4cxClZbLTz1engOw7k+0kGdWxlNlJQ9OV03jj8iMeaDtWCLbJBt+5Fcg6Ix2HddFEkgcTNLMK7TMeWfm4xo34ouzBJcwf8iEszLy++1T2lRHBevGr0YAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='repeatable read 2' title='' src='/static/04301891349f8e62ebb5cc9ad151566d/ca1dc/repeatable_read_2.png' srcset='/static/04301891349f8e62ebb5cc9ad151566d/e7570/repeatable_read_2.png 170w,\n/static/04301891349f8e62ebb5cc9ad151566d/f46e7/repeatable_read_2.png 340w,\n/static/04301891349f8e62ebb5cc9ad151566d/ca1dc/repeatable_read_2.png 680w,\n/static/04301891349f8e62ebb5cc9ad151566d/02d09/repeatable_read_2.png 1020w,\n/static/04301891349f8e62ebb5cc9ad151566d/9d567/repeatable_read_2.png 1360w,\n/static/04301891349f8e62ebb5cc9ad151566d/0c665/repeatable_read_2.png 2043w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>변경되는 레코드는 언두 로그에 백업된다.</p>\n<p>이후 트랜잭션 2번이 커밋 혹은 롤백되기 전에 트랜잭션 3번이 <code class=\"language-text\">id=2</code>를 조회하는 상황이다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/62e27e12f45850934110435b47c15595/20d0f/repeatable_read_3.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 48.8235294117647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABdElEQVR42o2STUtCURCGXz+upZnZTcvE7Fpqmd1KylJCISpMgz4QNYQgAnet3dayRZuW/bc2/ZPe8c4VixYNPJyvOXNm3jmAY7tkg+yQFd3zED/xEe/EntgsqZKi3vH8OkecWCRFkiRKZsgaOSQZEtL9CFlS/2NySVbJkT6EsEZeIAESUwcJOE8qpGCaiITDiAtcZ8ki2SMNUtNsRxl29UBeTJD1QACbhgGbY0GDS0Y5DbQsD6gUJpkic7oema2OWS1LMrwlbXJFGWuhWKJVqWBY2sdLKY8hRT74AAytytVurJ87kfLEKWJZ6HW7uHu4x3XKturRar/+9orG4AnNwTmaF8Dpp1OyVFWWqlRDSWbcwXHAfB437TYe+z3003byDKGySBFUjU062V9s3onzO1qkrhr6JjOMasCoapTW7kqnc9S0KJqSLYqWead22462fm2s/6+Sp2XS6cDnAjx7J/6iO/fo6Gr4wzwTfzGI/5uh2f+wb6eTJDwljnjTAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='repeatable read 3' title='' src='/static/62e27e12f45850934110435b47c15595/ca1dc/repeatable_read_3.png' srcset='/static/62e27e12f45850934110435b47c15595/e7570/repeatable_read_3.png 170w,\n/static/62e27e12f45850934110435b47c15595/f46e7/repeatable_read_3.png 340w,\n/static/62e27e12f45850934110435b47c15595/ca1dc/repeatable_read_3.png 680w,\n/static/62e27e12f45850934110435b47c15595/02d09/repeatable_read_3.png 1020w,\n/static/62e27e12f45850934110435b47c15595/9d567/repeatable_read_3.png 1360w,\n/static/62e27e12f45850934110435b47c15595/20d0f/repeatable_read_3.png 2051w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>사실 Read Committed와 동일하다.</p>\n<p>하지만 내부적으로 트랜잭션 3번에서 실행되는 모든 SELECT 쿼리는, 해당 트랜잭션 번호인 3번보다 앞선 트랜잭션 번호를 가진, 언두 로그의 데이터들만 조회한다.</p>\n<p>언두 로그에는 하나의 레코드에 다양한 버전으로 백업된 레코드가 충분히 존재할 수 있다.<br>\n이러한 상황에서 Repeatable Read 격리 수준은 이 <strong>트랜잭션 번호를 이용해서, 하나의 트랜잭션 내에서 발생하는 SELECT 쿼리에 대해 항상 동일한 값을 반환하도록 한다.</strong></p>\n<p>Repeatable Read 격리 수준에서도 발생하는 정합성 문제가 있다.<br>\n바로 <em><code class=\"language-text\">Phantom Read</code></em> 문제다.</p>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/9ae01cd91f664e748e1e344d1e5877bb/4c40c/phantom_read.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 52.352941176470594%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABXUlEQVR42oWSy07CQBiFfyylsShqURQvKFArVlCxiYlGWeiGqGFjEI2EROO2G2HPS/AyvAePwY4X8MzkNFZj4iRfZjr//XRERPKgBvZAXb6XAWwyx7sE9wy4AlVwCkzatD0NdkABbIB1sAJW6XwZu8tyV76b4Bp0gAtueKezpulo0OiAeXZ9AbbYlUqYAx5jGuAFPNBvSSUMaKiwQo0B56BESXYZsM+CHkcvs1sfLEdaJcEiWKMWqsA7eCINdtBhNz1wwNgcJ0zG9NXLilWoFwryEQTSc115pDZH1PMWtNhRgpL4nOIYFOMJlYZi23LSbEoYhvLZ7cqrcrQsPZpHWeqcwqEMb4YhTXAPP/evDg+pU4mjedwr1LBKTYU25XtGLX+M7PBsYlSr3ZaU70sK3xEmUefkcKjfZnYwkHK/L8+jkdzNZlpTid5i/tfj/W+pH7E9mcjCeCxFxXQqmS9pXCiKmNrdtAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img.png' title='' src='/static/9ae01cd91f664e748e1e344d1e5877bb/ca1dc/phantom_read.png' srcset='/static/9ae01cd91f664e748e1e344d1e5877bb/e7570/phantom_read.png 170w,\n/static/9ae01cd91f664e748e1e344d1e5877bb/f46e7/phantom_read.png 340w,\n/static/9ae01cd91f664e748e1e344d1e5877bb/ca1dc/phantom_read.png 680w,\n/static/9ae01cd91f664e748e1e344d1e5877bb/02d09/phantom_read.png 1020w,\n/static/9ae01cd91f664e748e1e344d1e5877bb/9d567/phantom_read.png 1360w,\n/static/9ae01cd91f664e748e1e344d1e5877bb/4c40c/phantom_read.png 1918w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>img.png</figcaption>\n  </figure></p>\n<p>트랜잭션 3번이 2번의 <code class=\"language-text\">SELECT ... FOR UPDATE</code> 쿼리를 날리는 사이에, 트랜잭션 2번이 INSERT를 통해 값을 추가한다.<br>\n이때, 트랜잭션 3번이 날리는 2개의 <code class=\"language-text\">SELECT ... FOR UPDATE</code> 쿼리 결과는 달라진다.<br>\n이렇게 새로운 데이터가 생기거나 사라지는 현상을 <em>Phantom Read</em> 라고 한다.</p>\n<p>전제 조건이 있긴 한데, 하나의 트랜잭션 안에서 <code class=\"language-text\">SELECT ... FOR UPDATE</code> 나 <code class=\"language-text\">SELECT ... FOR LOCK IN SHARE MODE</code> 로 조회하는 경우에 발생한다.</p>\n<p>위의 두 쿼리는 SELECT 하는 레코드에 <strong>쓰기 잠금</strong>을 걸어야 한다.<br>\n하지만 <strong>언두 로그에는 잠금을 걸 수 없다.</strong><br>\n그래서 위 쿼리로 조회되는 레코드는 언두 영역의 레코드가 아닌, 버퍼 풀의 레코드이기 때문이다.</p>\n<p><strong>InnoDB 엔진에서는 **갭 락과 넥스트 키 락</strong> 덕분에 해당 격리 수준에서도 Phantom Read 문제가 발생하지 않는다.**</p>\n<h2>Serializable</h2>\n<p>가장 단순하며 엄격한 격리 수준이다.</p>\n<p>간단히 생각해서 뮤텍스처럼 동작하는 격리 수준이다.</p>\n<p>InnoDB 테이블에서 기본적으로 순수한 SELECT 작업은 다른 트랜잭션의 변경 작업 수행 여부와 상관없이 잠금을 대기하지 않고 바로 수행된다. (잠금 없는 일관된 읽기)</p>\n<p>하지만 격리 수준이 Serializable인 경우 순수 SELECT 작업도 공유 잠금(읽기 잠금)을 획득해야 한다.<br>\n즉, 특정 트랜잭션이 레코드를 조회하고 있을 때에도 다른 트랜잭션은 조회하지 못하고 잠금을 대기해야 한다.</p>\n<p>이러한 특징 때문에 정합성 관련 문제는 발생하지 않지만 동시성 처리 능력은 가장 떨어진다.</p>\n<h3>Reference</h3>\n<blockquote>\n<ul>\n<li><a href=\"https://product.kyobobook.co.kr/detail/S000001766482\">https://product.kyobobook.co.kr/detail/S000001766482</a></li>\n</ul>\n</blockquote>","frontmatter":{"title":"MySQL의 격리 수준","date":"January 11, 2024","update":null,"tags":["database","MySQL"],"series":"Real MySQL 8.0"},"fields":{"slug":"/05-isolation-level-of-MySQL/","readingTime":{"minutes":9.745}}},"seriesList":{"edges":[{"node":{"id":"014bd317-3394-5c4d-9a72-e1319712838a","fields":{"slug":"/03-user-identification/"},"frontmatter":{"title":"MySQL에서의 사용자 식별에 대해"}}},{"node":{"id":"69b6441a-edde-5385-b6a3-0df3608f6657","fields":{"slug":"/04-mysql-engine-architecture/"},"frontmatter":{"title":"MySQL 엔진 아키텍처"}}},{"node":{"id":"cf713bbe-9c34-54b6-9d8b-9f1b1f12ebfe","fields":{"slug":"/04-innodb-engine/"},"frontmatter":{"title":"InnoDB 엔진 이해하기"}}},{"node":{"id":"f21b2f2c-8b87-52fe-965b-01011033f9f5","fields":{"slug":"/04-mysql-log/"},"frontmatter":{"title":"MySQL 로그 파일"}}},{"node":{"id":"076df81f-9afd-5dfe-bc33-fff6402d1ddc","fields":{"slug":"/05-transaction-and-lock/"},"frontmatter":{"title":"MySQL에서의 트랜잭션과 Lock"}}},{"node":{"id":"c1af5fc8-26e9-523f-ab94-cd74c7a9f8b5","fields":{"slug":"/05-isolation-level-of-MySQL/"},"frontmatter":{"title":"MySQL의 격리 수준"}}},{"node":{"id":"48bcea91-2f18-5443-9881-eb4e2cdd272f","fields":{"slug":"/05-lock-of-innodb-storage-engine/"},"frontmatter":{"title":"InnoDB 스토리지 엔진의 락"}}},{"node":{"id":"0a33b9d9-8548-50e3-a895-0d1011aec7b1","fields":{"slug":"/08-03-b-tree-index/"},"frontmatter":{"title":"B-Tree 인덱스에 대해 알아보자"}}}]},"previous":{"fields":{"slug":"/compare-of-datetime-and-timestamp/"},"frontmatter":{"title":"[MySQL] DATETIME vs TIMESTAMP"}},"next":{"fields":{"slug":"/05-lock-of-innodb-storage-engine/"},"frontmatter":{"title":"InnoDB 스토리지 엔진의 락"}}},"pageContext":{"id":"c1af5fc8-26e9-523f-ab94-cd74c7a9f8b5","series":"Real MySQL 8.0","previousPostId":"def28d41-907f-5432-8060-ed5429114882","nextPostId":"48bcea91-2f18-5443-9881-eb4e2cdd272f"}},"staticQueryHashes":[],"slicesMap":{}}