{"componentChunkName":"component---src-templates-post-jsx","path":"/04-mysql-engine-architecture/","result":{"data":{"site":{"siteMetadata":{"title":"log4dh"}},"markdownRemark":{"id":"69b6441a-edde-5385-b6a3-0df3608f6657","excerpt":"MySQL 엔진 아키텍처  MySQL 서버는 크게 MySQL 엔진과 스토리지 엔진으로 나뉜다. MySQL 엔진 클라이언트와의 연결, 요청된 쿼리문을 파악하고 분석 및 최적화하는 작업을 수행한다. 그 후, 실제 동작은 스토리지 엔진에 요청한다. 이를 핸들러 요청이라고 하고, 여기에 사용되는 API를 핸들러 API라고 한다. 명령어로 핸들러 API를 확인할 …","html":"<h2>MySQL 엔진 아키텍처</h2>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/b9c53b77681406b338ac3bd2a26be5b8/38ea8/entire-structure-mysql.jpg' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 88.23529411764706%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAASABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAECBAX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHtqQaAAAf/xAAaEAACAgMAAAAAAAAAAAAAAAAAAQIRECAh/9oACAEBAAEFAmLE1ZXdP//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABYQAAMAAAAAAAAAAAAAAAAAAAAwQf/aAAgBAQAGPwIiP//EABsQAAIDAQEBAAAAAAAAAAAAAAERECExAGFx/9oACAEBAAE/IdaOIhX6hw6vvKhtgvahT//aAAwDAQACAAMAAAAQgwc8/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPxAf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPxAf/8QAHRABAAICAgMAAAAAAAAAAAAAAQARECExUXGBof/aAAgBAQABPxC6wDytw4rHS/mKStgcI36gSW4AbL7hoCIeQlY//9k='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='MySQL의 전체 구조' title='' src='/static/b9c53b77681406b338ac3bd2a26be5b8/a22ce/entire-structure-mysql.jpg' srcset='/static/b9c53b77681406b338ac3bd2a26be5b8/0b705/entire-structure-mysql.jpg 170w,\n/static/b9c53b77681406b338ac3bd2a26be5b8/31389/entire-structure-mysql.jpg 340w,\n/static/b9c53b77681406b338ac3bd2a26be5b8/a22ce/entire-structure-mysql.jpg 680w,\n/static/b9c53b77681406b338ac3bd2a26be5b8/29373/entire-structure-mysql.jpg 1020w,\n/static/b9c53b77681406b338ac3bd2a26be5b8/38ea8/entire-structure-mysql.jpg 1134w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>MySQL의 전체 구조</figcaption>\n  </figure></p>\n<p>MySQL 서버는 크게 <strong>MySQL 엔진</strong>과 <strong>스토리지 엔진</strong>으로 나뉜다.</p>\n<h3>MySQL 엔진</h3>\n<p>클라이언트와의 연결, 요청된 쿼리문을 파악하고 분석 및 최적화하는 작업을 수행한다.</p>\n<p>그 후, 실제 동작은 <em>스토리지 엔진</em>에 요청한다.</p>\n<p>이를 <em>핸들러 요청</em>이라고 하고, 여기에 사용되는 API를 <em>핸들러 API</em>라고 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">mysql<span class=\"token operator\">></span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>SHOW GLOBAL STATUS LIKE Handler%<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>명령어로 핸들러 API를 확인할 수 있다.</p>\n<p>MySQL 엔진은 아래와 같은 기능들로 이루어져 있다.</p>\n<ul>\n<li>커넥션 핸들러</li>\n<li>SQL 인터페이스</li>\n<li>SQL 파서</li>\n<li>SQL 옵티마이저</li>\n<li>캐시 &#x26; 버퍼</li>\n</ul>\n<h3>스토리지 엔진</h3>\n<p>종류로는 MyISAM, InnoDB 스토리지 엔진이 있다.</p>\n<p>실제 데이터를 디스크에서 읽거나 쓰는 작업을 수행한다.</p>\n<h2>MySQL 스레딩 구조</h2>\n<p>MySQL은 프로세스 기반이 아닌 쓰레드 기반으로 동작한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">mysql<span class=\"token operator\">></span> <span class=\"token keyword\">SELECT</span> thread_id<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">,</span> <span class=\"token keyword\">type</span><span class=\"token punctuation\">,</span> processlist_user<span class=\"token punctuation\">,</span> processlist_host <span class=\"token keyword\">FROM</span> performance_schema<span class=\"token punctuation\">.</span>threads <span class=\"token keyword\">ORDER</span> <span class=\"token keyword\">BY</span> <span class=\"token keyword\">type</span><span class=\"token punctuation\">,</span> thread_id<span class=\"token punctuation\">;</span></code></pre></div>\n<p>위 명령어로 실행 중인 쓰레드를 확인할 수 있다.</p>\n<h3>Foreground Thread</h3>\n<p>클라이언트의 요청을 처리하는 쓰레드이다. 때문에 클라이언트 쓰레드 혹은 사용자 쓰레드라고도 부른다.</p>\n<p>클라이언트의 요청을 모두 처리하면, 쓰레드 캐시로 돌아간다.<br>\n이때, 쓰레드 캐시가 가득 찬 상태라면 쓰레드를 종료시킨다.</p>\n<p>데이터를 MySQL의 <strong>데이터 버퍼</strong>나 <strong>캐시</strong>로부터 가져오는 작업을 수행한다.</p>\n<p>하지만 버퍼나 캐시에 데이터가 없는 경우, InnoDB 기준으로는 직접 디스크에서 데이터를 가져오는 작업은 <strong>백그라운드 쓰레드</strong>에서 처리된다.</p>\n<h3>Background Thread</h3>\n<p>InnoDB 기준, 아래와 같은 여러 작업들이 백그라운드 쓰레드에 의해 처리된다.</p>\n<ul>\n<li>Insert Buffer를 병합하는 작업</li>\n<li>로그를 디스크에 쓰는 작업</li>\n<li>InnoDB 버퍼 풀의 데이터를 디스크에 쓰는 작업</li>\n<li>데이터를 버퍼로 읽어오는 작업</li>\n<li>잠금이나 데드락을 모니터링하는 작업</li>\n</ul>\n<p>아울러, 주로 디스크에 쓰기 작업을 수행하기 때문에 백그라운드 쓰레드의 개수는 적정 수를 유지하는 것이 중요하다.</p>\n<p>쓰기 작업은 버퍼링을 통해 일괄 작업해도 괜찮다. 오히려 효율적이다. 따라서 이러한 방식으로 처리한다.</p>\n<h2>메모리 할당 및 사용 구조</h2>\n<h3>글로벌 메모리 영역</h3>\n<p>MySQL 서버가 실행되면서 운영체제로부터 할당받는 공간이다.</p>\n<p>필요에 따라 2개 이상의 메모리 공간을 할당받을 수 있다.</p>\n<p>글로벌 메모리 영역이 2개 이상이더라도 모든 쓰레드에 의해 공유된다.</p>\n<p>아래의 기능들이 글로벌 메모리 영역에 존재한다.</p>\n<ul>\n<li>테이블 캐시</li>\n<li>InnoDB 버퍼 풀</li>\n<li>InnoDB 어댑티브 해시 인덱스</li>\n<li>InnoDB 리두 로그 버퍼</li>\n</ul>\n<h3>로컬 메모리 영역</h3>\n<p>클라이언트 쓰레드가 쿼리를 처리할 때 사용하는 메모리 영역이기에, 클라이언트 메모리 영역이라고도 한다.<br>\n클라이언트와의 커넥션을 <em>세션</em>이라고도 하기에, 세션 메모리 영역이라고도 한다.</p>\n<p>로컬 메모리는 각 클라이언트 쓰레드 별로 독립적으로 할당되며 사용된다.</p>\n<p>대표적인 로컬 메모리 영역은 다음과 같다.</p>\n<ul>\n<li>정렬 버퍼</li>\n<li>조인 버퍼</li>\n<li>바이너리 로그 캐시</li>\n<li>네트워크 버퍼</li>\n</ul>\n<h2>쿼리 실행 구조</h2>\n<p>클라이언트로부터 쿼리 요청이 들어오면 다음과 같은 순으로 처리된다.</p>\n<p>쿼리 파서 -> 전처리기 -> 옵티마이저 -> 쿼리 실행기</p>\n<h3>쿼리 파서</h3>\n<p>요청으로 넘어온 SQL문을 MySQL이 인식할 수 있는 최소한의 단위인 토큰으로 분리해 트리 구조로 만드는 작업을 수행한다.</p>\n<p>SQL 문법 오류는 쿼리 파서에 의해 감지되고 에러를 발생한다.</p>\n<h3>전처리기</h3>\n<p>쿼리 파서의 결과인 <em>파서 트리</em>를 기반으로 쿼리 문장에 구조적 문제를 파악한다.</p>\n<p>테이블이 존재하는지? 칼럼이 존재하는지? 권한이 있는지? 와 같이, 실제 쿼리를 동작했을 때 이상이 없을 지를 판단한다.</p>\n<h3>옵티마이저</h3>\n<p>SQL문을 가장 효율적으로 실행하기 위한 <strong>실행 계획</strong>을 수립한다.</p>\n<h3>쿼리 실행기</h3>\n<p>실행 계획을 바탕으로 스토리지 엔진에게 작업을 요청하고, 그 결과를 사용자에게 반환한다. </p>","frontmatter":{"title":"MySQL 엔진 아키텍처","date":"December 14, 2023","update":null,"tags":["database"],"series":"Real MySQL 8.0"},"fields":{"slug":"/04-mysql-engine-architecture/","readingTime":{"minutes":6.175}}},"seriesList":{"edges":[{"node":{"id":"014bd317-3394-5c4d-9a72-e1319712838a","fields":{"slug":"/03-user-identification/"},"frontmatter":{"title":"MySQL에서의 사용자 식별에 대해"}}},{"node":{"id":"69b6441a-edde-5385-b6a3-0df3608f6657","fields":{"slug":"/04-mysql-engine-architecture/"},"frontmatter":{"title":"MySQL 엔진 아키텍처"}}},{"node":{"id":"cf713bbe-9c34-54b6-9d8b-9f1b1f12ebfe","fields":{"slug":"/04-innodb-engine/"},"frontmatter":{"title":"InnoDB 엔진 이해하기"}}},{"node":{"id":"f21b2f2c-8b87-52fe-965b-01011033f9f5","fields":{"slug":"/04-mysql-log/"},"frontmatter":{"title":"MySQL 로그 파일"}}},{"node":{"id":"076df81f-9afd-5dfe-bc33-fff6402d1ddc","fields":{"slug":"/05-transaction-and-lock/"},"frontmatter":{"title":"MySQL에서의 트랜잭션과 Lock"}}},{"node":{"id":"c1af5fc8-26e9-523f-ab94-cd74c7a9f8b5","fields":{"slug":"/05-isolation-level-of-MySQL/"},"frontmatter":{"title":"MySQL의 격리 수준"}}},{"node":{"id":"48bcea91-2f18-5443-9881-eb4e2cdd272f","fields":{"slug":"/05-lock-of-innodb-storage-engine/"},"frontmatter":{"title":"InnoDB 스토리지 엔진의 락"}}},{"node":{"id":"0a33b9d9-8548-50e3-a895-0d1011aec7b1","fields":{"slug":"/08-03-b-tree-index/"},"frontmatter":{"title":"B-Tree 인덱스에 대해 알아보자"}}}]},"previous":{"fields":{"slug":"/why-wrap-primitive-type-and-string/"},"frontmatter":{"title":"모든 원시값과 문자열을 포장한다. 왜?"}},"next":{"fields":{"slug":"/04-innodb-engine/"},"frontmatter":{"title":"InnoDB 엔진 이해하기"}}},"pageContext":{"id":"69b6441a-edde-5385-b6a3-0df3608f6657","series":"Real MySQL 8.0","previousPostId":"50eb9a45-26ac-517f-991c-9140da539386","nextPostId":"cf713bbe-9c34-54b6-9d8b-9f1b1f12ebfe"}},"staticQueryHashes":[],"slicesMap":{}}