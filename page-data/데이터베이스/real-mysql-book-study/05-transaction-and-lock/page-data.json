{"componentChunkName":"component---src-templates-blog-post-js","path":"/데이터베이스/real-mysql-book-study/05-transaction-and-lock/","result":{"data":{"site":{"siteMetadata":{"title":"김동호 블로그"}},"markdownRemark":{"id":"3a6845b8-4d42-5d5a-9652-a363b020c77a","excerpt":"트랜잭션 트랜잭션은 최소한의 논리적인 작업 단위이다. 하나의 작업 단위에 포함되는 모든 작업들이 100% 성공해야 트랜잭션이 commit 되며, 중간에 작업 하나라도 문제가 생겼을 땐 작업 전체를 무효화한다. (All or Nothing) 이를 통해 데이터의 정합성을 보장한다. ACID…","html":"<h2 id=\"트랜잭션\" style=\"position:relative;\"><a href=\"#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98\" aria-label=\"트랜잭션 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.65 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>트랜잭션</h2>\n<p>트랜잭션은 <strong>최소한의 논리적인 작업 단위이다.</strong></p>\n<p>하나의 작업 단위에 포함되는 모든 작업들이 100% 성공해야 트랜잭션이 commit 되며, 중간에 작업 하나라도 문제가 생겼을 땐 작업 전체를 무효화한다. (<em>All or Nothing</em>)</p>\n<p>이를 통해 데이터의 정합성을 보장한다.</p>\n<h3 id=\"acid-모델\" style=\"position:relative;\"><a href=\"#acid-%EB%AA%A8%EB%8D%B8\" aria-label=\"acid 모델 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.65 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ACID 모델</h3>\n<p>데이터베이스 설계 원칙으로 ACID 모델이 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e0d7750aa8f3c0b309818a3a634d8975/0f79a/img.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.632911392405056%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABtklEQVR42nVSa2/UQAzs//9HfEFIVBQhEG2vubts3pvHbZ6bxyWCJJfB67aCnmgkS7ZnNZ6xc3P3KPDN8vDx+x4f7h4hpMK9iPDpxwG39za+7lyUbU+4hdsHgS8Un38e8d53s64XnMcRbddjOJ85b3QH3XbohoHrrh8ImyifsND7eVneJ9ywIU4S2EJAOA78IITjuDgcBcIwgucHlNuIZMzYNE0cywvptm0cfwmpaLsOSuVI0hRFWaFuGlR1g7KqUVKt8hwN9SSR5kXB2DzP/1d43QhI1e5pD8f12a61P7KyVw3ZSeFh90RhwaO+wY+2w/i6rs+Er5KXZSWVGau9XDYMw8hWzZ4H2qfKC2TZCVprtmwITPxr/43C3/OCJMuRnsgiXbZqWrh+iLLWZF8jlAlkQgOLimxrPl6tW8aLqqEjjm8JZ1LoBRJ7OoghNQ93ZMn1I+S0y4PtQtAqzBDrIOCHErbjI04VMlUQeXdFSAqNgiCKSe2M/jzytUuaXpNaGae8kpT2GEQSaaY4N7+bWdF6uba8GMsKrhfytLYfuV7WjS0FkbF84ghliijOXgQkhGv8mlf8Abtv84qtW+V7AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img\"\n        title=\"\"\n        src=\"/static/e0d7750aa8f3c0b309818a3a634d8975/f058b/img.png\"\n        srcset=\"/static/e0d7750aa8f3c0b309818a3a634d8975/c26ae/img.png 158w,\n/static/e0d7750aa8f3c0b309818a3a634d8975/6bdcf/img.png 315w,\n/static/e0d7750aa8f3c0b309818a3a634d8975/f058b/img.png 630w,\n/static/e0d7750aa8f3c0b309818a3a634d8975/0f79a/img.png 689w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>InnoDB의 트랜잭션은 이 ACID 모델을 준수한다.</p>\n<ul>\n<li><strong>Atomic</strong>: 원자성, 트랜잭션의 작업은 전부 적용되거나 전부 적용되지 않아야 한다.</li>\n<li><strong>Consistency</strong>: 일관성, 데이터베이스는 트랜잭션이 진행되거나 커밋되거나 롤백된 모든 경우에 항상 일관된 상태로 유지된다.</li>\n<li><strong>Isolation</strong>: 고립성, 트랜잭션끼리는 서로 간섭할 수 없다. 뒷장에 나올 고립 수준으로 고립성의 정도를 조절할 수 있다.</li>\n<li><strong>Durability</strong>: 지속성, 트랜잭션이 commit 된 후에는 반드시 디스크에 반영해야 한다.</li>\n</ul>\n<p>자세한 내용은 <a href=\"https://dev.mysql.com/doc/refman/8.0/en/mysql-acid.html\">MySQL 공식문서</a> 참고</p>\n<h3 id=\"주의할-점\" style=\"position:relative;\"><a href=\"#%EC%A3%BC%EC%9D%98%ED%95%A0-%EC%A0%90\" aria-label=\"주의할 점 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.65 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>주의할 점</h3>\n<p>트랜잭션 또한 DB Connection과 마찬가지로 <strong>최소한의 범위로 적용하는 것이 좋다.</strong></p>\n<p>트랜잭션의 범위가 많다는 것은 처리해야 할 작업이 많다는 것이고 이는 Connection이 존재하는 시간이 길어진다는 의미이다.<br>\nDB Connection의 수는 한정적이므로 하나의 Connection이 존재하는 시간이 길어지면 그만큼 다른 요청을 처리하는 데에 장애가 생길 확률이 높아진다.</p>\n<p>그리고 트랜잭션에 <strong>네트워크를 통해 원격 서버와 통신하는 등의 작업은 어떻게 해서든 트랜잭션 내에서 제거하는 것이 좋다.</strong><br>\n트랜잭션이 실행되는 동안 외부 서버와 통신할 수 없는 상태라면, 해당 트랜잭션은 영영 처리되지 못하게 되며 다른 트랜잭션에도 악영향을 끼칠 수 있다.</p>\n<h2 id=\"mysql-엔진의-lock\" style=\"position:relative;\"><a href=\"#mysql-%EC%97%94%EC%A7%84%EC%9D%98-lock\" aria-label=\"mysql 엔진의 lock permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.65 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MySQL 엔진의 Lock</h2>\n<p>Lock은 동시성을 제어하기 위한 기능이다.</p>\n<p>여러 Connection이 동시에 동일한 자원에 대해 변경을 요청한 경우, 경쟁 조건이 발생하는 것을 방지하기 위한 역할을 한다.</p>\n<p>크게 MySQL 엔진 레벨과 스토리지 엔진 레벨의 Lock으로 나눌 수 있다.</p>\n<p>MySQL 엔진 레벨의 Lock은 모든 스토리지 엔진에 영향을 미치지만, 스토리지 엔진 레벨의 Lock은 스토리지 엔진 간 상호 영향을 미치지 않는다.</p>\n<h3 id=\"글로벌-락\" style=\"position:relative;\"><a href=\"#%EA%B8%80%EB%A1%9C%EB%B2%8C-%EB%9D%BD\" aria-label=\"글로벌 락 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.65 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>글로벌 락</h3>\n<ul>\n<li>\n<p><code class=\"language-text\">FLUSH TABLES WITH READ LOCK;</code> 명령으로 글로벌 락을 획득할 수 있다.</p>\n</li>\n<li>\n<p>MySQL에서 제공하는 Lock 가운데 범위가 가장 크다.</p>\n</li>\n<li>\n<p>하나의 Connection에서 글로벌 락을 획득하면 다른 Connection에서 SELECT를 제외한 대부분의 DDL이나 DML을 실행한 경우 글로벌 락이 해제될 때까지 대기한다.</p>\n</li>\n<li>\n<p>영향을 미치는 범위는 MySQL 서버 전체이며, 작업 대상 테이블이나 데이터베이스가 다르더라도 동일하게 영향을 미친다.</p>\n</li>\n</ul>\n<h3 id=\"테이블-락\" style=\"position:relative;\"><a href=\"#%ED%85%8C%EC%9D%B4%EB%B8%94-%EB%9D%BD\" aria-label=\"테이블 락 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.65 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>테이블 락</h3>\n<ul>\n<li>\n<p>개별 테이블 단위에 설정하는 락이다.</p>\n</li>\n<li>\n<p>묵시적으로도 테이블 락을 획득할 수 있으나, 명시적으로는 <code class=\"language-text\">LOCK TABLES table_name [ READ | WRITE ];</code> 명렁으로 특정 테이블에 대한 락을 획득할 수 있다.<br>\n이렇게 명시적으로 획득한 락은 <code class=\"language-text\">UNLOCK TABLES</code> 명령으로 락을 반환할 수 있다.<br>\n사실 명시적인 잠금은 글로벌 락과 마찬가지로 특별한 상황이 아니라면 애플리케이션에서 거의 사용할 필요가 없다.</p>\n</li>\n<li>\n<p>묵시적 테이블 락은 MyISAM이나 MEMORY 테이블에 쓰기 작업의 쿼리를 실행하면 발생한다.<br>\n쿼리가 실행되는 동안 자동으로 획득했다가 쿼리가 완료된 후 자동 해제되는 식으로 동작한다.</p>\n<ul>\n<li>InnoDB 테이블의 경우, 스토리지 엔진 차원에서 레코드 기반 Lock을 지원하므로 DML 쿼리에서는 묵시적 테이블 락이 적용되지는 않는다.<br>\nDDL의 경우에만 묵시적 테이블 락을 획득한다.</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"네임드-락\" style=\"position:relative;\"><a href=\"#%EB%84%A4%EC%9E%84%EB%93%9C-%EB%9D%BD\" aria-label=\"네임드 락 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.65 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>네임드 락</h3>\n<ul>\n<li>\n<p><code class=\"language-text\">GET_LOCK()</code> 함수를 이용해 <strong>임의의 문자열에 대해 Lock을 설정할 수 있다.</strong></p>\n</li>\n<li>\n<p>Lock의 대상이 데이터베이스 객체가 아니라는 특징이 있다.<br>\n단순히 사용자가 지정한 문자열에 대해 획득하고 반납하는 Lock이다.</p>\n</li>\n<li>\n<p>자주 사용되지는 않는다.<br>\n여러 클라이언트가 상호 동기화를 처리해야 할 때 네임드 락을 이용하면 쉽게 해결할 수 있다.<br>\n또, 많은 레코드에 대해 복잡한 요건으로 레코드를 변경하는 트랜잭션에 유용할 수 있다.</p>\n</li>\n</ul>\n<p>자세한 내용은 <a href=\"https://dev.mysql.com/doc/refman/8.0/en/locking-functions.html\">MySQL 공식문서</a> 참고</p>\n<blockquote>\n<p>한번 보면 좋을만한 글<br>\n<a href=\"https://techblog.woowahan.com/2631/\">우아한기술블로그 - MySQL의 네임드 락을 이용한 분산 락으로 여러 서버에 걸친 동시성 관리</a></p>\n</blockquote>\n<h3 id=\"메타데이터-락\" style=\"position:relative;\"><a href=\"#%EB%A9%94%ED%83%80%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%9D%BD\" aria-label=\"메타데이터 락 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.65 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>메타데이터 락</h3>\n<ul>\n<li>\n<p>데이터베이스 객체(테이블 or 뷰)의 이름이나 구조를 변경하는 경우에 획득하는 Lock이다.</p>\n</li>\n<li>\n<p>명시적으로 획득할 수는 없고, 테이블의 이름을 변경과 같은 경우에 자동으로 획득하는 Lock이다.</p>\n<ul>\n<li>테이블을 변경하는 작업의 경우 원본 이름과 변경될 이름 두 개 모두 한꺼번에 Lock을 획득한다.</li>\n</ul>\n</li>\n</ul>","tableOfContents":"<ul>\n<li>\n<p><a href=\"#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98\">트랜잭션</a></p>\n<ul>\n<li><a href=\"#acid-%EB%AA%A8%EB%8D%B8\">ACID 모델</a></li>\n<li><a href=\"#%EC%A3%BC%EC%9D%98%ED%95%A0-%EC%A0%90\">주의할 점</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#mysql-%EC%97%94%EC%A7%84%EC%9D%98-lock\">MySQL 엔진의 Lock</a></p>\n<ul>\n<li><a href=\"#%EA%B8%80%EB%A1%9C%EB%B2%8C-%EB%9D%BD\">글로벌 락</a></li>\n<li><a href=\"#%ED%85%8C%EC%9D%B4%EB%B8%94-%EB%9D%BD\">테이블 락</a></li>\n<li><a href=\"#%EB%84%A4%EC%9E%84%EB%93%9C-%EB%9D%BD\">네임드 락</a></li>\n<li><a href=\"#%EB%A9%94%ED%83%80%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%9D%BD\">메타데이터 락</a></li>\n</ul>\n</li>\n</ul>","frontmatter":{"title":"MySQL에서의 트랜잭션과 Lock","date":"2024년 1월 3일","description":"5.1 트랜잭션, 5.2 MySQL 엔진의 잠금","tags":["database"],"series":"Real MySQL 8.0"}},"previous":{"fields":{"slug":"/데이터베이스/real-mysql-book-study/04-mysql-log/"},"frontmatter":{"title":"MySQL 로그 파일"}},"next":{"fields":{"slug":"/데이터베이스/compare-of-datetime-and-timestamp/"},"frontmatter":{"title":"[MySQL] DATETIME vs TIMESTAMP"}}},"pageContext":{"id":"3a6845b8-4d42-5d5a-9652-a363b020c77a","previousPostId":"faaca863-1b19-55de-9204-23d78becba10","nextPostId":"eaa7297c-f67c-5df3-9c42-2fd3cafab7e9"}},"staticQueryHashes":["1475414628","2841359383"],"slicesMap":{}}